\documentclass[handout]{beamer}

\input{aulas-beamer-preamble}
\usepackage{xcolor}
\usepackage{ulem}


\title[Programação Modular]
{%
	Testes unitários e TDD
}

\author[Prof. Pedro Pongelupe]
{
	Prof.~Pedro Pongelupe
}
\institute[DCC / PUC Minas]
{\epsfig{file=puclogo_small_bw,width=1.5cm} \\
  \textsc{Pontifícia Universidade Católica de Minas Gerais}\\
	Departamento de Ciência da Computação
}
\date[]{}

\lstset{language=Java,
   basicstyle=\scriptsize,
   commentstyle=\color{red},
   showstringspaces=false,
   numbers=none,
   numberstyle=\tiny}

\begin{document}


\selectlanguage{brazil}

\begin{frame}
   \titlepage
\end{frame}

%\addtobeamertemplate{frametitle}{}{%
%	\begin{tikzpicture}[remember picture,overlay]
%	\node[anchor=north east,yshift=2pt] at (current page.north east) {\epsfig{file=puclogo_small_bw,width=1.2cm}};
%	\end{tikzpicture}}


%\addtobeamertemplate{frametitle}{}{%
	%\begin{tikzpicture}[node distance=0cm, remember picture, overlay, every node/.style={inner sep=0,outer sep=0, node distance=0cm, baseline=0cm}]
	%\node[anchor=north east] at (current page.north east) {\epsfig{file=puclogo_small_bw,width=1cm}};
	%\end{tikzpicture}}


%\logo{\includegraphics[height=0.8cm]{puclogo_small_bw.pdf}\vspace{220pt}}


\begin{frame}
   \frametitle{Sumário}
   \tableofcontents[pausesections]
\end{frame}

%\AtBeginSection[] % Do nothing for \section*
%{
%\begin{frame}<beamer>
%\frametitle{Outline}
%\tableofcontents[currentsection]
%\end{frame}}


\addtobeamertemplate{frametitle}{}{%
   \begin{textblock*}{10mm}(.9945\textwidth,-1.72cm)
	   \includegraphics[height=1cm]{puclogo_small_bw.pdf}
   \end{textblock*}
}


\section{Princípios de Teste de Software}

\begin{frame}{Debugging}
        \begin{block}{O quê é??}
                Processo utilizado para remover erros de programação. 
        \end{block}
        \begin{block}{Passo-a-Passo}
                \begin{itemize}
                        \item Detectar o erro.
                        \item Localizar o erro.
                        \item Solucionar o erro.
                \end{itemize}
        \end{block}
        \begin{block}{Tipos de erros de programação:}
                \begin{itemize}
                        \item Erros de sintaxe/compilação
                        \item Erros em tempo de execução.
                        \item Erros semânticos ou de lógica
                \end{itemize}
        \end{block}
\end{frame}

\subsection{Tipos de erros - Exemplo IMC}
\begin{frame}[fragile]{Índice de Massa Corporal}

        Considere o exemplo a seguir que calcula o Índice de Massa Corporal (IMC) de uma pessoa, dados seu peso e altura.

        \begin{lstlisting}
public class CalculadoraIMC {
  private double peso, altura, imc;

  public CalculadoraIMC(double peso, double altura) {
    this.peso = peso;
    this.altura = altura;
  }
  public void calcular() {
    this.imc = peso / (altura * altura);
  }
  public boolean comSobrepeso() {
    return (imc > 25);
  }
  public double getImc() {
    return this.imc;
  }
}
        \end{lstlisting}

\end{frame}

\begin{frame}[fragile]{Erros de sintaxe}

\begin{itemize}
\item Violam normas gramaticais da linguagem.
\item São capturados previamente pelos compiladores ou interpretadores.
\item São identificadas pela IDE.
\end{itemize}

\begin{lstlisting}
  public void calcular() {
    this.imc = peso / (altura * altura),
  }
\end{lstlisting}
\end{frame}


\begin{frame}[fragile]{Erros em tempo de execução}

        \begin{itemize}
                \item Ocorrem durante a execução do programa.
                \item Não podem ser capturados pelo compilador ou pela IDE. 
                \item Em algumas IDEs, o erro pode ser alertado. Exemplo: Variável não inicializada.
                \item Devem ser antecipados e tratados.
        \end{itemize}

        \begin{lstlisting}
  public void calcular() {
    this.imc = peso / (altura * altura);
  }
        \end{lstlisting}

        Se a altura for igual a 0 (zero), ocorrerá o erro ``\textit{/ by zero}'' (divisão por zero).
\end{frame}

\begin{frame}[fragile]{Erros semânticos ou de lógica}

        \begin{itemize}
                \item Os mais difíceis de detectar. 
                \item Programa irá ``funcionar'', mas a saída estará incorreta.
        \end{itemize}

        \begin{lstlisting}
  public void calcular() {
    this.imc = (peso * peso) / altura;
  }
        \end{lstlisting}

\end{frame}

\subsection{Princípios do teste de software}

\begin{frame}{Princípios do teste de software}

\begin{itemize}
\item Objetivo do teste é verificação e validação.
\end{itemize}

\begin{block}{Verificação}
objetiva responder se o sistema foi construído corretamente.
\end{block}

\begin{block}{Validação}
tenta determinar se foi construído o sistema certo.
\end{block}

\end{frame}

\begin{frame}{Custo do teste de software}

\begin{itemize}
\item O custo do erro aumenta, quanto mais se demora a detectá-lo.
\end{itemize}

{\centering \includegraphics[width=.73\textwidth]{custoTeste.pdf}

{\tiny Adaptado de: \textit{Beginning Java Programming (2015) - Bart Baesens and Aimée Backiel}; Capítulo 1, pg. 7}}
\end{frame}

\begin{frame}{Custo do teste de software}


{\centering \includegraphics[width=.7\textwidth]{debug_meme.png}

{\tiny Adaptado de: \textit{Beginning Java Programming (2015) - Bart Baesens and Aimée Backiel}; Capítulo 1, pg. 7}}
\end{frame}

\section{Test-Driven Development (TDD)}
\subsection{TDD: o quê é}
\begin{frame}{Test-Driven Development (TDD)}
\begin{block}{O quê é??}
        Metodologia de desenvolvimento de software que enfatiza o teste. Desenvolvimento dirigido por testes.
\end{block}
\textit{"Escreva o código de teste primeiro. Então, escreva o código operacional e depure o programa até que ele passe no teste."}
        \begin{itemize}
                \item Principais premissas:
                        \begin{itemize}
                                \item Os testes de unidade são desenvolvidos \underline{antes} do código. 
                                \item Software é desenvolvido em pequenas iterações.
                        \end{itemize}

        \end{itemize}
\end{frame}

\subsection{TDD: como funciona}

\begin{frame}{TDD: como funciona}

\begin{enumerate}
\item Adicione um teste.
\begin{itemize}
\item Estórias do usuário ajudam a entender os requisitos.
\end{itemize}
\item Execute todos os testes e veja o novo falhar.
\begin{itemize}
\item Garante que o mecanismo de teste está funcionando e que o teste não irá passar por engano. 
\end{itemize}
\item Escreva o código.
\begin{itemize}
\item Apenas o código que foi projetado para passar no teste.
\item Nenhuma funcionalidade adicional deve ser incluída, pois não seria testada.
\end{itemize}
\end{enumerate}

\end{frame}



\begin{frame}{TDD: como funciona}

\begin{enumerate}
\setcounter{enumi}{3}
\item Execute os testes e veja eles serem bem sucedidos.
\begin{itemize}
\item Se o teste passou, tem-se confiança de que o código atende aos requisitos testados. 
\end{itemize}
\item Refatore o código.
\begin{itemize}
\item Limpe o código e reexecute os testes para garantir que nada foi quebrado.
\end{itemize}
\end{enumerate}

Repita o processo.

\end{frame}

\section{Teste de unidade e JUnit}

\subsection{Teste de unidade}

\begin{frame}{Teoria do teste de unidade}

\begin{block}{Teste unitário (ou teste de unidade)}
Para cada trecho de código operacional -- uma classe ou um método, o código operacional deve estar pareado com um código de ``teste unitário''.
\end{block} 

\vspace{5mm}

\textit{``If you can't write a test for what you are about to code, then you shouldn't even be thinking about coding.''}\footnote{George, Boby; Williams, Laurie. \textit{A Structured experiment of test-driven development}. 2003.}
\end{frame}

\begin{frame}{Teste de unidade}

        \begin{itemize}
                \item O código do teste unitário chama o código operacional a partir da sua interface pública, de diversas formas e verifica os resultados.
                \item O teste não precisa ser exaustivo -- código de teste já agrega um grande valor, mesmo nos casos centrais.
                \item Testes unitários são uma forma padronizada de manter os testes em paralelo com o desenvolvimento do programa.
                \item Testes de unidade são fáceis de executar.
                        \begin{itemize}
                                \item uma vez configurados, eles produzem \textit{feedback} rápido para você testar suas ideias.
                        \end{itemize}
        \end{itemize}
\end{frame}

\subsection{Arquitetura do Padrão xUnit}
\begin{frame}{Padrão xUnit}
        \begin{block}{História}
                Para realização de testes unitários, a arquitetura mais bem adotada é a de \underline{xUnit} que derivam do SUnit, que é para a linguagem Smalltalk.
                \begin{itemize}
                        \item \href{https://wiki.python.org/moin/PyUnit}{PyUnit} $\longrightarrow$ Python  
                        \item \href{https://github.com/kward/shunit2}{shUnit2} $\longrightarrow$ Shell Script 
                        \item \href{https://xunit.net/}{xUnit.net} $\longrightarrow$ C\# / .net
                        \item \href{https://junit.org/junit5/}{jUnit} $\longrightarrow$ Java  
                \end{itemize}
        \end{block} 


\end{frame}
\begin{frame}{Arquitetura Padrão xUnit}
        \begin{block}{Componentes Básicos}
                \begin{itemize}
                        \item Test Runner: Engine que roda o teste 
                        \item Test Case: Cenário de teste (@Test)
                        \item Test Suites: Conjunto de testes de um determinado contexto
                        \item Test Context: Precondições necessárias para executar os testes
                        \item Assertions: Funções para assegurar valores do testes
                \end{itemize}
        \end{block} 


\end{frame}


\subsection{jUnit}
\begin{frame}[fragile]{Assertions}
        \begin{table}[h]
                \centering
                \begin{tabular}{|l|l|}
                        \hline
                        Assert & Descrição     \\ \hline
                        \textit{assertTrue(teste)} & falha se teste booleano é \textbf{false}. \\ \hline
                        \textit{assertFalse(teste)} & falha se teste booleano é \textbf{true}. \\ \hline
                        \textit{assertEquals(esperado, teste)*} & falha se valores não forem iguais. \\ \hline
                        \textit{assertNull(teste)} & falha se valor não for \textbf{null}. \\ \hline
                        \textit{assertNotNull(teste)} & falha se valor for \textbf{null}. \\ \hline
                \end{tabular}
        \end{table}
\end{frame}

\begin{frame}[fragile]{Inicialização e finalização}
        Métodos executados antes ou depois de cada caso de teste
\begin{lstlisting}
  @BeforeEach
  void setup() {
  ...
  }

  @AfterEach
  void tearDown() {
  ...
  }
\end{lstlisting}
\end{frame}
\begin{frame}[fragile]{Inicialização e finalização}
        Métodos executados uma única vez, antes ou depois da execução de toda a suíte de testes
\begin{lstlisting}
  @BeforeAll
  void setupBefore() {
  ...
  }

  @AfterAll
  void tearDownAfter() {
  ...
  }
\end{lstlisting}
\end{frame}


\begin{frame}{Bora práticar!}
O disco de vinil já foi o meio mais popular de compartilhar música, mas apresenta uma limitação técnica no qual cada disco de vinil só pode armazenar 30 minutos de áudio por lado. Para álbuns mais longos que 1 hora era necessário mais de um disco de vinil, o que encarece o processo. 


        \begin{block}{Programação Modular Records}
                Fazer orçamentos baseado na duração do álbum (em minutos) e no número de cópias a serem feitas:
                \begin{itemize}
                        \item R\$ 15,00 por disco 
                        \item R\$ 420,00 de serviços da comissão técnica.
                \end{itemize}
        \end{block} 

\end{frame}

\begin{frame}[fragile]{Obrigado!!}
        Muito obrigado pela atenção! Alguma dúvida? Bora praticar!!!
        \begin{block}{  }
                "\textit{O conhecimento nos faz responsáveis.}"
        \end{block}
\end{frame}

\end{document}
