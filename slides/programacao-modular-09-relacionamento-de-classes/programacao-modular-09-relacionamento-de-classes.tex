\documentclass[handout]{beamer}

\input{aulas-beamer-preamble}


\title[Programação Modular]
{%
    Relacionamento de classes%
}
\author[Prof. Hugo de Paula]
{
    Prof.~Hugo~de~Paula
}
\institute[DCC / PUC Minas]
{\includegraphics[width=4cm]{puc_engesoft_logo.png} \\
	\textsc{Pontifícia Universidade Católica de Minas Gerais}\\
	Curso de Engenharia de Software
}
%\institute[DCC / PUC Minas]
%{\epsfig{file=puclogo_small_bw,width=1.5cm} \\
%	\textsc{Pontifícia Universidade Católica de Minas Gerais}\\
%	Departamento de Ciência da Computação
%}
\date[]{}

\lstset{language=Java,
   basicstyle=\scriptsize,
   commentstyle=\color{red},
   showstringspaces=false,
   numbers=none,
   numberstyle=\tiny}

\begin{document}


\selectlanguage{brazil}

\begin{frame}
   \titlepage
\end{frame}

%\addtobeamertemplate{frametitle}{}{%
%    \begin{tikzpicture}[remember picture,overlay]
%    \node[anchor=north east,yshift=2pt] at (current page.north east) {\epsfig{file=puclogo_small_bw,width=1.2cm}};
%    \end{tikzpicture}}


%\addtobeamertemplate{frametitle}{}{%
    %\begin{tikzpicture}[node distance=0cm, remember picture, overlay, every node/.style={inner sep=0,outer sep=0, node distance=0cm, baseline=0cm}]
    %\node[anchor=north east] at (current page.north east) {\epsfig{file=puclogo_small_bw,width=1cm}};
    %\end{tikzpicture}}


%\logo{\includegraphics[height=0.8cm]{puclogo_small_bw.pdf}\vspace{220pt}}


\begin{frame}
   \frametitle{Sumário}
   \tableofcontents[pausesections]
\end{frame}

%\AtBeginSection[] % Do nothing for \section*
%{
%\begin{frame}<beamer>
%\frametitle{Outline}
%\tableofcontents[currentsection]
%\end{frame}}


\addtobeamertemplate{frametitle}{}{%
	\begin{textblock*}{10mm}(.8785\textwidth,-1.75cm)
		\includegraphics[height=0.97cm]{puc_engesoft_logo.png}%\includegraphics[height=1cm]{puclogo_small_bw.pdf}
	\end{textblock*}
}
%\addtobeamertemplate{frametitle}{}{%
%   \begin{textblock*}{10mm}(.9945\textwidth,-1.71cm)
%    \includegraphics[height=1cm]{puclogo_small_bw.pdf}
%   \end{textblock*}
%}


\section{Relacionamento entre objetos}


\begin{frame}{Uso e reuso}
\begin{itemize}
    \item Programar é uma atividade de repetição com pequenas modificações.
    \item Seria desejável construir um catálogo de componentes de software de tal forma a construir um novo sistema.
    \item Obstáculos: as repetições não são exatas.
    \item Reusabilidade é fundamental para reduzir custos e aumentar confiabilidade.
    \item Modularidade é a chave para atingir alto grau de reusabilidade.
\end{itemize}
\end{frame}

\begin{frame}{Relacionamentos entre objetos}
\begin{itemize}
\item \textbf{Associação}: objeto ``usa'' serviços de outro objeto.
\begin{itemize}
\item Mensagens disparam operações.
\item Operações (métodos) retornam resultados.
\end{itemize}
\item \textbf{Agregação}: objeto definido em termos de seus componentes.
\begin{itemize}
\item relação parte/todo (``tem um'').
\end{itemize}
\item \textbf{Composição}: relação ``está contido''.
\begin{itemize}
\item dependência de tempo de vida entre a parte e o todo.
\end{itemize}
\end{itemize}
\end{frame}

\subsection{Associação}

\begin{frame}{Associação}
    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Aluno}
     \umlemptyclass[x=6]{Escola}
     \umluniassoc[mult1=*, arg2=estuda, mult2=1]{Aluno}{Escola} 
    \end{tikzpicture} \\[15mm]
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=7]{Carro}
     \umlassoc[arg1=pertence, mult1=1, arg2=possui, mult2=*]{Aluno}{Carro} 
    \end{tikzpicture} 
\end{center}
\end{frame}

\begin{frame}{Classe de associação}
    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=8]{Livro}
     \umlassoc[mult1=*, mult2=*, name=emp]{Pessoa}{Livro} 
     \umlassocclass[x=4, y=-1.7, , anchor1=-130]{Emprestimo}{emp-1}{dtEmprest : Data \\ dtDevol : Data}{}
    \end{tikzpicture} \\[5mm]
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlclass[x=5]{Emprestimo}{dtEmprest : Data \\ dtDevol : Data}{}
     \umlemptyclass[x=9]{Livro}
     \umlassoc[mult2=*]{Pessoa}{Emprestimo} 
     \umlassoc[mult1=*]{Emprestimo}{Livro} 
    \end{tikzpicture} 
\end{center}
\end{frame}

\subsection{Agregação e composição}

\begin{frame}{Agregação x composição}
\begin{itemize}
    \item \textbf{Agregação}: a existência da ``parte'' faz sentido, mesmo não existindo ``todo''.
        \begin{itemize}
            \item partes podem eventualmente pertencer a mais de um todo (não simultaneamente).
            \item Ex: Atleta $\longrightarrow$ Time\\[2mm]
        \end{itemize}
    \item \textbf{Composição}: relacionamento mais forte. A existência da parte \textit{\textbf{não}} faz sentido se o todo não existir.
        \begin{itemize}
            \item as partes não podem ser compartilhadas.
            \item Ex: Itens $\longrightarrow$ Pedido \\[2mm]
        \end{itemize}
    \item Relacionamentos do tipo ``composição'' indicam que se apaguem os objetos associados quando o todo for destruído/finalizado.
\end{itemize}
\end{frame}

\begin{frame}{Exemplo de agregação e composição}
    \begin{center}
    Agregação \\
    \begin{tikzpicture} 
     \umlclass{Time}{-- nomeTime \\ -- tecnico}{}
     \umlclass[x=5]{Atleta}{-- nome \\ -- idade \\ -- numCamisa}{}
     \umlaggreg[mult1=0..1, mult2=*]{Time}{Atleta} 
    \end{tikzpicture} \\
    Composição \\
    \begin{tikzpicture} 
     \umlclass{Pedido}{-- idPedido \\ -- data \\ -- valorDesconto}{}
     \umlclass[x=6]{ItemPedido}{-- idItem \\ -- descricao \\ -- quantidade \\ -- valorUnitario}{}
     \umlcompo[mult1=1, mult2=1..*]{Pedido}{ItemPedido} 
    \end{tikzpicture} 
\end{center}
\end{frame}



\begin{frame}{Exemplo de agregação e composição}
    \begin{center}
    \begin{tikzpicture} 
     \umlclass{Pedido}{}{}
     \umlclass[x=6]{Item}{}{}
     \umlcompo[mult1=1, mult2=1..*]{Pedido}{Item} 
    \end{tikzpicture} \\[5mm]
    \begin{tikzpicture} 
     \umlclass{Pedido}{}{}
     \umlclass[y=-1.5]{Venda}{}{}
     \umlclass[x=6]{Item}{}{}
     \umlaggreg[mult1=1, mult2=1..*]{Pedido}{Item} 
     \umlaggreg[mult1=0..1, mult2=1..*, geometry=-|]{Venda}{Item} 
    \end{tikzpicture} 
\end{center}
\end{frame}




\begin{frame}{Exemplo de associação, agregação e composição}
    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=6]{Carro}
     \umlassoc[arg=possui um, mult1=1, mult2=*]{Pessoa}{Carro} 
    \end{tikzpicture} \\[5mm]
    \begin{tikzpicture} 
     \umlemptyclass{Carro}
     \umlemptyclass[x=5]{Radio}
     \umlaggreg[arg=possui um, pos=0.5]{Carro}{Radio} 
    \end{tikzpicture} \\[5mm]
    \begin{tikzpicture} 
     \umlemptyclass{Carro}
     \umlemptyclass[x=6]{Motor}
     \umlcompo[arg=é guiado por, pos=0.5]{Carro}{Motor} 
    \end{tikzpicture} 
\end{center}
\end{frame}

\subsection{Cardinalidade das associações}

\begin{frame}{Cardinalidade das associações}

\begin{itemize}
\item \textit{um-para-um}
    \begin{itemize}
        \item Ex: um Curso tem um Coordenador\\[3mm]
    \end{itemize}
\item \textit{um-para-muitos}
    \begin{itemize}
        \item Ex: um Departamento tem muitos Professores, mas um Professor está alocado a um Departamento apenas   \\[3mm]     
    \end{itemize}
\item \textit{muitos-para-muitos}
    \begin{itemize}
        \item Ex: um professor tem muitos alunos e um aluno tem aulas com vários professores\\[3mm]
    \end{itemize}
\item A cardinalidade \textit{muitos} pode ser qualificada. 
    \begin{itemize}
        \item Ex: um aluno pode solicitar muitos livros na biblioteca, mas esse número é limitado a no máximo 5 ($[0..5]$)
    \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Multiplicidade na UML}

\begin{description}
\item [1] -- exatamente 1 \\[2mm]
\item [0..1] -- zero ou 1 \\[2mm]
\item [*]  -- zero ou mais \\[2mm]
\item [1..*] -- um ou mais \\[2mm]
\item [1..10] -- um até dez \\[2mm]
\item [1,10] -- um ou dez \\[2mm]
\item [0,5..10] -- zero ou de 5 a dez
\end{description}

\end{frame}



\begin{frame}{Cardinalidade}
    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Curso}
     \umlemptyclass[x=6]{Coordenador}
     \umlassoc[mult1=1, mult2=1]{Curso}{Coordenador} 
    \end{tikzpicture} \\[5mm]
    \begin{tikzpicture} 
     \umlemptyclass{Departamento}
     \umlemptyclass[x=5]{Professor}
     \umlaggreg[mult1=1, mult2=*]{Departamento}{Professor} 
    \end{tikzpicture} \\[5mm]
    \begin{tikzpicture} 
     \umlemptyclass{Aluno}
     \umlemptyclass[x=6]{Professor}
     \umlassoc[mult1=*, mult2=*]{Aluno}{Professor} 
    \end{tikzpicture} 
\end{center}
\end{frame}





\section{Exemplo: Controle de Estoque}

\begin{frame}[fragile]{Exemplo: Controle de Estoque}
\begin{center}\tiny
    \begin{tikzpicture} 
     \umlclass{Estoque}{-- produtos : Produto[]}{
        + adicionar( : Produto) \\
        + remover(descricao : String) \\
        + totalEmEstoque()  : int \\
        + valorEmEstoque() : float
     }
     \umlclass[x=7.]{Produto}{\umlstatic{+ DESC\_PADRAO} \\
                             \umlstatic{+ MAX\_ESTOQUE} \\
                             \umlstatic{-- cont : int} \\
                             -- id : int \\
                             -- descricao : String \\ 
                             -- preco : float \\
                             -- quant : int}{}
     \umluniassoc[arg=produtos, pos=0.6, mult2={$\;\;\;\;\;\;\;\;[0..100]$}]{Estoque}{Produto} 
    \end{tikzpicture}
\end{center}
\end{frame}


\begin{frame}[fragile]{Exemplo: Controle de Estoque}
\begin{lstlisting}[basicstyle=\tiny]
public class Estoque {
   private static final int MAX_PRODUTOS = 100;
   private Produto[] listaDeProdutos;
   private int numProdutos;

   public void adicionar(Produto p) {
      if (numProdutos < MAX_PRODUTOS) {
         listaDeProdutos[numProdutos++] = p;
      }
   }

   public void remover(String descricao) {
      if (numProdutos > 0) {
         for (int pos = 0; pos < numProdutos; pos++) {
            if (descricao.equalsIgnoreCase(listaDeProdutos[pos].getDescricao())) {
               // remove produto
               for (int i = pos + 1; i < numProdutos; i++)
                  listaDeProdutos[i - 1] = listaDeProdutos[i];
            }

         }
      }
   }

   ...
\end{lstlisting}
\end{frame}





\begin{frame}[fragile]{Exemplo: Controle de Estoque}
\begin{lstlisting}[basicstyle=\tiny]
   public int totalEmEstoque() {
      int total = 0;
      for (int i = 0; i < numProdutos; i++)
         total += listaDeProdutos[i].getQuant();
      return total;
   }
   public float valorEmEstoque() {
      float valor = 0;
      for (int i = 0; i < numProdutos; i++)
         valor += listaDeProdutos[i].getQuant() * listaDeProdutos[i].getPreco();
      return valor;
   }
   public String exibirEstoque()
   {
      StringBuilder valor = new StringBuilder();
      for (int i = 0; i < numProdutos; i++)
         valor.append("Produdo: " + listaDeProdutos[i].getId() 
                  + "- " + listaDeProdutos[i].getDescricao() 
                  + "   Preço: " + listaDeProdutos[i].getPreco()
                  + "   Quant.: " + listaDeProdutos[i].getQuant() + "\n");
      return valor.toString();
   }
   public Estoque() {
      listaDeProdutos = new Produto[MAX_PRODUTOS];
      numProdutos = 0;
   }
}
\end{lstlisting}
\end{frame}

\section{Projeto de relações}

\subsection{Papeis}

\begin{frame}{Associação e papeis}
    Nome de associação:
    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=6]{Carro}
     \umlassoc[name=possui]{Pessoa}{Carro}
     \node[above] at (possui-1) {possui};
    \end{tikzpicture}
    \end{center}
    Nomes de papeis da associação:
    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=7]{Carro}
     \umlassoc[arg1=dono, mult1=1, arg2=frota, mult2=*]{Aluno}{Carro} 
    \end{tikzpicture} 
    \end{center}
    Múltiplos papeis:
    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=7]{Carro}
     \umlassoc[anchors=-25 and -155, arg1=dono, mult1=1, arg2=frota, mult2=*]{Pessoa}{Carro} 
     \umlassoc[anchors=25 and 155, arg1=motorista, mult1=0..1, mult2=0..1]{Pessoa}{Carro} 
    \end{tikzpicture} 
    \end{center}
\end{frame}

\begin{frame}{Múltiplos papeis como classes de associação}
    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=8]{Empresa}
     \umlemptyclass[x=8, y=-2.3]{Pedido}
     \umlassoc[anchors=25 and 155, attr1=*|dadosPessoais, attr2=localTrab|*, name=func]{Pessoa}{Empresa} 
     \umlassoc[anchors=-25 and -155, attr1=*|comprador, attr2=loja|*, name=cli]{Pessoa}{Empresa} 
     \node[above](fnode) at (4,0.2) {};
     \node[below](cnode) at (4,-0.2) {};

     \umlassocclass[x=4, y=2.3, anchor1=130]{Funcionario}{fnode}{-- cargo : Cargo \\ -- salario: Moeda}{}
     \umlassocclass[x=4, y=-2.3, anchor1=130]{Cliente}{cnode}{-- limiteCred: Moeda}{}
     \umlassoc[arg1=1, arg2=*, name=cli]{Cliente}{Pedido} 
    \end{tikzpicture} 
    \end{center}
\end{frame}

\subsection{Navegabilidade}

\begin{frame}{Navegabilidade}
    \begin{center}
    \begin{tikzpicture} 
     \umlclass{Cliente}{-- nome \\ -- endereço}{}
     \umlclass[x=8]{Pedido}{-- data \\ -- situação}{+ calcTaxa():double \\ + calcTotal():double}
     \umlclass[x=3, y=-3]{Pagamento}{-- valor}{}
     \umluniassoc[geometry=|-, arg1=1, arg2=1..*, mult2=formaPagto, pos2=2, align2=left]{Pedido}{Pagamento} 
     \umlassoc[arg1=1,  arg2=0..*, name=cliped]{Cliente}{Pedido} 
     \node[above] at (cliped-1) {possui};
    \end{tikzpicture} 
    \end{center}
\end{frame}



\begin{frame}{Implementação de associações}

\begin{description}
\item [1] -- atributo simples (não pode ser \lstinline|null|) \\[2mm]
\item [0..1] -- atributo simples (pode ser \lstinline|null|) \\[2mm]
\item [*]  -- estruturas de dados ou coleções (listas, filas, pilhas, sets) \\[2mm]
\end{description}

\begin{block}{Navegabilidade e atributos}
Associações unidirecionais sugerem a implementação de atributos apenas na origem. Mas alguns casos exigem uma análise mais aprofundada.
    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=7]{Carro}
     \umluniassoc[mult1=1, mult2=*]{Pessoa}{Carro} 
    \end{tikzpicture} 
    \end{center}

\end{block}

\end{frame}

\begin{frame}{Operações de associações}
\footnotesize 
\begin{tabular}{r|lll}
\bf Tipo & \bf 1              & \bf 0..1           & \bf *          \\ \hline
get      & getPapel():Objeto  & getPapel():Objeto  & getPapel():Set    \\ 
add      & NSA                & addPapel(obj)      & addPapel(obj)     \\ 
remove   & NSA                & removePapel(obj)   & removePapel(obj)  \\ 
replace  & replacePapel(obj)  & replacePapel(obj)  & replacePapel(antigo, novo) \\ \hline
\end{tabular} 

\begin{tabular}{r|l}
\bf Tipo &  \bf * (com classe de associação)  \\ \hline
get      &  getPapel():Set                    \\ 
         &  getClasseDeAssociacao():Set       \\ 
         &  getClasseDeAssociacao(obj):obj    \\ 
add      &  addPapel(obj)     \\ 
remove   &  removePapel(obj)  \\ 
remove   &  removeClasseDeAssociacao(obj)  \\ 
replace  &  replacePapel(antigo, novo) \\ \hline
\end{tabular} 

\end{frame}


\begin{frame}[fragile]{Exemplo: Associação unidirecional para 1}

    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=7]{Carro}
     \umluniassoc[mult1=*, arg2=dono, mult2=1]{Carro}{Pessoa}
    \end{tikzpicture} 
    \end{center}

\begin{lstlisting}
class Carro {
   private Pessoa dono;
   
   public Carro(Pessoa dono) {
      this.dono = dono;
   }
   
   public Pessoa getDono() {
      return this.dono;
   }
   
   public void replaceDono(Pessoa novoDono) {
      this.dono = novoDono;
   }
}
\end{lstlisting}

\end{frame}


\begin{frame}[fragile]{Exemplo: Associação unidirecional para 0..1}

    \begin{center}
    \begin{tikzpicture} 
     \umlemptyclass{Pessoa}
     \umlemptyclass[x=7]{Carro}
     \umluniassoc[mult1=*, arg2=dono, mult2=0..1]{Carro}{Pessoa}
    \end{tikzpicture} 
    \end{center}

\setlength\columnsep{-10pt}
\begin{multicols}{2}
\begin{lstlisting}
class Carro {

 private Pessoa dono;

 public Carro(Pessoa dono) {
   this.dono = null;
 }

 public Pessoa getDono() {
   return this.dono;
 }


 public Pessoa addDono(Pessoa novo) {
   if (this.dono == null)
     this.dono = novo;
 }

 public removeDono() {
   this.dono = null;
 }

 public void replaceDono(Pessoa novo){
   this.dono = novo;
 }
}
\end{lstlisting}
\end{multicols}

\end{frame}


\begin{frame}[fragile]{Associações reflexivas}

\begin{itemize}
\item Uma classe pode estar associada a si mesma.
\end{itemize}

    \begin{center}
    \begin{tikzpicture} 
     \umlclass{Funcionario}{-- gerente: Funcionario}{}
     \umlassoc[loopsize=5cm, angle1=30, angle2=-30, arg1=gerente, mult1=1, arg2=equipe, mult2=0..*]{Funcionario}{Funcionario}
    \end{tikzpicture} 
    \end{center}


\end{frame}


\end{document}
